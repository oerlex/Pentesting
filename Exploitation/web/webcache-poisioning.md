# Webcache Poisioning

The cache key is defined by variables, such as header, cookies, parameters. It is common that the cache key consists of host header and URL. We want to find unkeyed input that can lead to a vulnerability such as XSS. Why unkeyed? Because when normal users browse the website they will send requests to the cache with the normal cache key and if we want to attack normal users we cannot change them.

A cache buster is a variable (param, header, cookie) in the request that no regular user would have e.g exampleurl.com?noonehasthis=123. That way we avoid the risk of breaking the webcache for all legitimate requests, hence all legitimate users.

## Basic Methodology

1. Specify a cache-buster!! (Don't forget this!)
2. Detected unkeyed input (headers, parameters, cookies)
3. Investigate if it has an effect on the response(reflected, in the response, different response)
4. Try to make it safed in the cache (caches might only safe requests with certain file extensions or status codes)

### Web cache poisoning with an unkeyed header (Example)
1. **Identify and evaluate unkeyed inputs** using BurpSuites ParamMiner. Right-Cick a request Extensions  -> ParamMiner -> Guess Headers
2. Investigate whether or not the headers have an effect on the response. It could be reflected, in the response directly, or triggering an entirely different response
3. Add a cache-buster query parameter, such as ?mycachebuster=1234abcd. NOTE! 
4. Add **X-Forwarded-Host: myexample.com** to the request

In this example the header **X-Forwarded-Host** is unkeyed and reflected in a script tag in the response, which pulls down a tracking javascript at examplehost.com/js/examplescript.js.

5. Spin up an internet exposed webserver and host a malicious .js file. For testing we can just enter **document.alert("hi xss")**. Besides the host the URL has to be identical to the one found in the response so mymalicioushost.com/js/examplescript.js
6. Remove the cache buster froms step 3 (Now the payload is live)
7. Change the request from X-Forwarded-Host: myexample.com to X-Forwarded-Host: mymalicioushost.com
8. Send the request a few times to be sure that it is cached. The timeout can vary so try out a bit
9. To simulate a victim go to the posinoned URL and observe the XSS window popping up


### Web cache poisioning with 


### Sources
https://portswigger.net/web-security/web-cache-poisoning
