### CodeQL Quick Start

1. mkdir ~/codeql-home
2. DL https://github.com/github/codeql-cli-binaries/releases and move to codeql-home
3. DL https://github.com/github/codeql and move to codeql-home (rename to codeql-repo
4. In the root of the repo to be analyzed run

```bash
codeql database create /codeql-db --language=python
```

Analyze
```bash
# Run one pre-made query 
codeql database analyze /codeql-db/ UnusedVariable.ql --format=csv --output=py-analysis/py-results.csv

# Run all queries in specified directory
codeql database analyze codeql-db ~/codeql-home/codeql-repo/java/ql/src/Security --format=sarif-latest --output=controller-test.sarif

# Run self-written query
```


#### Workflow
https://raz0r.name/articles/using-codeql-to-detect-client-side-vulnerabilities-in-web-applications/
Modern web applications tend to shift business logic from the server to the client. Typically the whole application can be found in a single JS file compiled with bundlers like webpack. In order to scan such bundles with CodeQL it is necessary to perform the following steps. Firstly, all the JS links should be gathered and downloaded. For this task one can use [subjs](https://github.com/lc/subjs) to find JS links and then [meg](https://github.com/tomnomnom/meg) or just wget to download all of them. After that one needs to build a CodeQL database from the gathered files using the command:

```bash
codeql database create example.com --language=javascript
```

After the database is built it is time to launch the actual scanning:
```bash
codeql database analyze example.com javascript-lgtm.qls --format=sarif-latest --output=results.sarif
```

This command uses default LGTM.comâ€™s query suite (javascript-lgtm.qls) and saves the results in Sarif format which can be later loaded in VSCode with the help of [Sarif Viewer](https://marketplace.visualstudio.com/items?itemName=MS-SarifVSCode.sarif-viewer) extension.

If you analyze bundles produced by webpack, the number of issues may be overwhelming for manual review. That is why it is always better to analyze unminified source code instead. When building with webpack, one may choose to include source mappings which can ease the debugging. With the source mappings it is possible to recover the original code. Web browsers automatically detect, fetch and interpret source mappings. However, it is not possible to save unpacked source code from a browser, so we will have to use a special tool called [unwebpack-sourcemap](https://github.com/rarecoil/unwebpack-sourcemap). With it the procedure is as easy as:

./unwebpack_sourcemap.py --detect https://example.com/auth/login example.com

After building and analyzing CodeQL database once again we can observe that the number of findings is much fewer and the results are significantly more relevant.