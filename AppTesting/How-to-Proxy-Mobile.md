# How to get in-between

## The No-Proxy Option
If we see some errors in the Burp Dashboard like
"The Client failed to establish a TLS connection..."
it could imply that the app is using certificate pinning. One way to circumvent this is to decompile the app and grep for all occurrences of the URL e.g. https://example.com

1. Decompile with [Jadx](https://github.com/skylot/jadx/releases/tag/v1.3.5) , [bytecode-viewer](https://github.com/konloch/bytecode-viewer/releases), or [apktool](https://ibotpeaches.github.io/Apktool/)
2. Find all occurrences of https://example.com with `grep "https://example.com" \* R`
3. Write a script to replace these occurences with you BurpListeners address

```python
  
path1 = "/home/bob/mobile/testapp_out/res/values/strings.xml" 
path2 = "/home/bob/mobile/testapp_out/assets/index.android.bundle"  
  
filePathArray = [path1, path2]  
  
for item in filePathArray:  
    with open(item, 'r') as file:  
        filedata = file.read()  
  
    # Replace the target string  
    filedata = filedata.replace('https://example.com', 'http://192.168.1.155:7575')  
  
    # Write the file out again  
    with open(item, 'w') as file:  
        file.write(filedata)
```

4. Repackage and Sign with [apksigner](https://developer.android.com/studio/command-line/apksigner)or [uber-apk-signer]](https://github.com/patrickfav/uber-apk-signer)
6. Install

### Automated
These steps can be automated using the scripts 
- [from Android 11] (https://gist.githubusercontent.com/floyd-fuh/7f7408b560672ece3ea78348559d47b6/raw/f24ac2df0752dcb69152b343a98deffd8cf1db69/repackage_apk_for_burp.py)
- [Before Android 11](https://github.com/laconicwolf/Android-App-Testing/blob/master/repackage_apk_for_burp.py)

I needed to change the code a bit you can find it here **TODO**

I put in a **input("Click once you modified the decompiled code")** after the script decompiled the APK. This gives me the oppurtunity to find and replace example.com with my IP as mentioned before.

Once you replaced it press enter and install the APK

#### Repack  
Newer Android version requires different signature scheme

https://developer.android.com/about/versions/11/behavior-changes-11#minimum-signature-scheme

## Frida-Gadget
https://fadeevab.com/frida-gadget-injection-on-android-no-root-2-methods/

Frida’s Gadget is a shared library meant to be loaded by programs to be instrumented when the Injected mode of operation isn’t suitable. There are two ways to inject a frida gadget.

1. If the APK contains native libraries (often under /apkname/lib/arm64-v8a/mysharedobject.so) you can inject libfrida-gadget.so into them. It might be difficult to know which and if the shared libraries are executed. Therefore you can inject all of them (I am not sure if this causes problems but I tried it and it worked smoothly)
2. If the APK does not contain native libraries you can inject System.LoadLibrary Bytecode

